function SetPagination(n,t,i=0){fetch("/Home/Refresh"+t,{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:"page="+n}).then(function(n){if(n.status!==200){console.log("Looks like there was a problem. Status Code: "+n.status);return}return n.text()}).then(function(n){document.getElementById("dv"+t).outerHTML=n}).then(function(){fetch("/Home/"+t+"Pagination",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:"page="+n}).then(function(n){if(n.status!==200){console.log("Looks like there was a problem. Status Code: "+n.status);return}return n.text()}).then(function(n){document.getElementById("divPagination"+t).innerHTML=n}).then(function(){pgrid_function();i!==0?(console.log("Пошло позиционирование на "+i),locate_model(i)):detail_function()}).catch(function(n){console.log("Fetch Error :-S",n)})}).catch(function(n){console.log("Fetch Error :-S",n)})}function SetPagination(n,t){fetch("/Home/Refresh"+t,{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:"page="+n}).then(function(n){if(n.status!==200){console.log("Looks like there was a problem. Status Code: "+n.status);return}return n.text()}).then(function(i){document.getElementById("dv"+t).outerHTML=i;fetch("/Home/"+t+"Pagination",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:"page="+n}).then(function(n){if(n.status!==200){console.log("Looks like there was a problem. Status Code: "+n.status);return}return n.text()}).then(function(n){document.getElementById("divPagination"+t).innerHTML=n})}).catch(function(n){console.log("Fetch Error :-S",n)})}$(document).ready(function(){function t(){return $("#MyUrl").val()}function o(n){$("#device_body tr").removeClass("selectlines");$('#device_body tr[data-id="'+n+'"]').toggleClass("selectlines")}function s(){var u,f,e;if(n.InitDevice_ID(),u=n.ID,u=="0"||u===undefined){alert("Не выбран прибор для удаления");return}let o=$('#device_body tr[data-id="'+n.ID+'"]>td:eq(0)>p').text().trim();(f=confirm(`Удалить прибор <${o}>?`),f)&&(e=i(),$.ajax({type:"POST",url:t()+"/DeleteDevice",data:{pDevice_ID:u,pModel_ID:e},success:function(n){var t=n;r(t)},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}}))}function i(){return $("#cbModels").val()}function h(){document.getElementById("dvDevices").innerHTML="";document.getElementById("divPaginationDevices").innerHTML=""}function c(){$("#device_body tr").click(function(){$("#device_body tr").removeClass("selectlines");$(this).toggleClass("selectlines")})}function r(n=1,u=0){h();Model_ID=i();$.ajax({type:"POST",url:t()+"/DevicesPagination",data:{pModel_ID:Model_ID,page:n},success:function(n){$("#divPaginationDevices").html(n);$(".device-page").click(function(n){let t=n.target.innerHTML;return r(t),!1})},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}});$.ajax({type:"POST",url:t()+"/RefreshDevices",data:{pModel_ID:Model_ID,page:n},success:function(n){$("#dvDevices").replaceWith(n);c();u!==0&&o(u)},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})}class f{ID=0;DeviceEF=null;DestroyModalForm(){this.DeviceEF!=null&&(this.DeviceEF.dispose(),this.DeviceEF=null)}InitDeviceEF(){this.DeviceEF==null&&(this.DeviceEF=new bootstrap.Modal("#DeviceModal",{keyboard:!0}));this.DeviceEF.show()}HideModalForm(){this.DeviceEF!==null&&this.DeviceEF.hide()}InitDevice_ID(){this.ID=0;let n=$("#device_body tr.selectlines:first");n&&(this.ID=n.attr("data-id"))}}class e{WaitingForm=null;DestroyWaitingForm(){this.WaitingForm!=null&&(this.WaitingForm.dispose(),this.WaitingForm=null)}HideWaitingForm(){this.WaitingForm!==null&&this.WaitingForm.hide()}InitWaitingForm(){this.WaitingForm==null&&(this.WaitingForm=new bootstrap.Modal("#WaitingForm",{keyboard:!0}));this.WaitingForm.show()}}let n=new f,u=new e;$("#DeviceModal").on("shown.bs.modal",function(){$("#edSerialNumber").focus()});$("#DeviceModal").on("hidden.bs.modal",function(){n.DestroyModalForm()});$("#DeviceModal").on("show.bs.modal",function(){var t=document.getElementById("SaveErrorDevice");t!=null&&(t.style.display="none");n.ID==0?($(this).find("#DeviceModalLabel").text("Добавить прибор"),$(this).find("#edSerialNumber").val(""),$(this).find("#cbRevisions").val(0)):($(this).find("#DeviceModalLabel").text("Изменить прибор"),$(this).find("#edSerialNumber").val($('#device_body tr[data-id="'+n.ID+'"]>td:eq(0)>p').text().trim()),$(this).find("#cbRevisions").val($('#device_body tr[data-id="'+n.ID+'"]').attr("data-revid")))});$("#btnDeviceSave").click(function(){var e=$("#edSerialNumber").val().trim(),u,f;if(e==""){alert("Серийный номер должен быть задан");return}if(u=$("#cbRevisions").val(),u==""||u==null){alert("Ревизия должна быть задана");return}f=i().trim();$.ajax({type:"POST",url:t()+"/SaveDevice",data:{sn:encodeURIComponent(e),current_ID:n.ID,model_ID:f,revision_ID:u},success:function(i){$("#divSaveDeviceMessage").replaceWith(i);vID=$("#LocateDevice_ID").val().trim();vID!="0"&&(n.HideModalForm(),$.ajax({type:"POST",url:t()+"/GetDevicePageNumber",data:{pModel_ID:f,pDevice_ID:vID},success:function(n){let t=n;r(t,vID)},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}}))},error:function(n,t,i){$("#divSaveDeviceMessage").html("<b>Произошла ошибка в процесе выполнения!<\/b>");alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})});$("#btnDeviceDelete").click(function(){s()});$("#btnDeviceAdd").click(function(){var t=i();if(t=="0"||t===undefined){alert("Не выбрана текущая модель");return}n.ID=0;n.InitDeviceEF()});$("#btnDeviceUpdate").click(function(){n.InitDevice_ID();var t=n.ID;if(t=="0"||t===undefined){alert("Не выбран прибор для редактирования");return}n.InitDeviceEF()});$("#cbModels").change(function(){r();Model_ID=$(this).val();$.ajax({type:"POST",url:t()+"/GetRevisionsByModel",data:{pModel_ID:Model_ID},success:function(n){$("#cbRevisions").replaceWith(n)},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})});$("#WaitingForm").on("hidden.bs.modal",function(){u.DestroyWaitingForm()});$("#btnRun").click(function(){u.InitWaitingForm();$.ajax({type:"POST",url:t()+"/RunMethod",data:{},success:function(){u.HideWaitingForm()},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})})});pgrid_function=null;locate_model=null;detail_function=null;$(document).ready(function(){function n(){return $("#MyUrl").val()}function f(){t==null&&(t=new bootstrap.Modal("#exampleModal",{keyboard:!0}));t.show()}function e(){i==null&&(i=new bootstrap.Modal("#RevisionModal",{keyboard:!0}));i.show()}function o(t){var i=u();if(i=="0"||i===undefined){alert("Не выбрана модель для удаления");return}$.ajax({type:"POST",url:n()+"/CheckDeleteModel",data:{pModel_ID:i},success:function(r){var u,f;if($("#ModelError").replaceWith(r),u=$("#IsModelError").val().trim(),u=="1"){alert("Модель используется. Удаление запрещено.");return}if(t){if(f=confirm("Удалить модель?"),!f)return;o(!1)}else $.ajax({type:"POST",url:n()+"/DeleteModel",data:{pModel_ID:i},success:function(n){var t=n;SetPagination(t,"Models")},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})},error:function(n,t,i){$("#ModelError").html("<b>Произошла ошибка в процесе проверки возможности удаления !<\/b>");alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText);return}})}function s(t){var i=c(),f;if(i=="0"||i===undefined){alert("Не выбрана ревизия для удаления");return}f=u();$.ajax({type:"POST",url:n()+"/CheckDeleteRevision",data:{pRevision_ID:i},success:function(u){var e,o;if($("#RevisionError").replaceWith(u),e=$("#IsRevisionError").val().trim(),e=="1"){alert("Ревизия используется. Удаление запрещено.");return}if(t){if(o=confirm("Удалить ревизию?"),!o)return;s(!1)}else $.ajax({type:"POST",url:n()+"/DeleteRevision",data:{pRevision_ID:i,pModel_ID:f},success:function(n){var t=n;r(t)},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})},error:function(n,t,i){$("#RevisionError").html("<b>Произошла ошибка в процесе проверки возможности удаления !<\/b>");alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText);return}})}function l(n){function f(n){$("#imgModelPhoto").attr("src",n.target.result);$("#divImageResult").show()}var u=n.files[0],t=u.type,i=["image/jpeg","image/png","image/jpg"],r;t==i[0]||t==i[1]||t==i[2]?(r=new FileReader,r.onload=f,r.readAsDataURL(n.files[0])):alert("Invalid File Extension")}function a(){document.getElementById("dvRevisions").innerHTML="";document.getElementById("divPaginationRevisions").innerHTML=""}function v(){$("#revision_body tr").click(function(){$("#revision_body tr").removeClass("selectlines");$(this).toggleClass("selectlines");var n=$(this).data("id");$("#Current_Revision_ID").val(n)})}function y(){h();r()}function p(n){$("#model_body tr").removeClass("selectlines");$('#model_body tr[data-id="'+n+'"]').toggleClass("selectlines");$("#Current_Model_ID").val(n);r()}function h(){$("#model_body tr").click(function(){$("#model_body tr").removeClass("selectlines");$(this).toggleClass("selectlines");var n=$(this).data("id");$("#Current_Model_ID").val(n);r()})}function w(n){$("#revision_body tr").removeClass("selectlines");$('#revision_body tr[data-id="'+n+'"]').toggleClass("selectlines");$("#Current_Revision_ID").val(n)}function r(t=1,i=0){a();Model_ID=u();(Model_ID=="0"||Model_ID===undefined)&&(Model_ID=0);$.ajax({type:"POST",url:n()+"/RevisionPagination",data:{pModel_ID:Model_ID,page:t},success:function(n){$("#divPaginationRevisions").html(n);$(".device-page").click(function(n){let t=n.target.innerHTML;return r(t),!1})},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}});$.ajax({type:"POST",url:n()+"/RefreshRevisions",data:{pModel_ID:Model_ID,page:t},success:function(n){$("#dvRevisions").replaceWith(n);v();i!==0&&w(i)},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})}function u(){return $("#Current_Model_ID").val()}function c(){return $("#Current_Revision_ID").val()}$("#exampleModal").on("shown.bs.modal",function(){$("#edModelName").focus()});$("#exampleModal").on("hidden.bs.modal",function(){t!=null&&(t.dispose(),t=null)});$("#RevisionModal").on("shown.bs.modal",function(){$("#edRevisionName").focus()});$("#RevisionModal").on("hidden.bs.modal",function(){i!=null&&(i.dispose(),i=null)});$("#exampleModal").on("show.bs.modal",function(){var i=document.getElementById("SaveErrorModel"),t;i!=null&&(i.style.display="none");$("#imgModelPhoto").attr("src","");$("#edModelPhoto").val("");$("#divImageResult").hide();t=$("#Model_ID").val().trim();t==0?($(this).find("#exampleModalLabel").text("Добавить модель"),$(this).find("#edModelName").val(""),$(this).find("#edModelDescription").val("")):($(this).find("#exampleModalLabel").text("Изменить модель"),$(this).find("#edModelName").val($('#model_body tr[data-id="'+t+'"]>td:eq(0)>p').text().trim()),$(this).find("#edModelDescription").val($('#model_body tr[data-id="'+t+'"]>td:eq(1)>p').text().trim()),$.ajax({type:"POST",url:n()+"/GetModelImage",data:{pModel_ID:t},success:function(n){$("#imgModelPhoto").attr("src",n);n!=""&&$("#divImageResult").show()},error:function(n,t,i){$("#divImageResult").html("<b>Произошла ошибка в процесе получения изображения!<\/b>");alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}}))});$("#RevisionModal").on("show.bs.modal",function(){var t=document.getElementById("SaveErrorRevision"),n;t!=null&&(t.style.display="none");n=$("#Revision_ID").val().trim();n==0?($(this).find("#RevisionModalLabel").text("Добавить ревизию"),$(this).find("#edRevisionName").val("")):($(this).find("#RevisionModalLabel").text("Изменить ревизию"),$(this).find("#edRevisionName").val($('#revision_body tr[data-id="'+n+'"]>td:eq(0)>p').text().trim()))});var t=null,i=null;$("#btnModelDelete").click(function(){o(!0)});$("#btnRevisionDelete").click(function(){s(!0)});$("#edModelPhoto").change(function(){var n=this.files.length;if(!n)return $("#imgModelPhoto").attr("src",""),$("#divImageResult").hide(),!1;if(this.files[0].size>3e6)return alert("Максимальный размер файла должен быть 3 мегабайта!"),$("#imgModelPhoto").attr("src",""),$("#edModelPhoto").val(""),$("#divImageResult").hide(),!1;l(this)});$("#btnModelSave").click(function(){var r=$("#edModelName").val().trim();if(r==""){alert("Название должно быть задано");return}var i=$("#Model_ID").val().trim(),u=$("#edModelDescription").val().trim(),f=$("#imgModelPhoto").attr("src");$.ajax({type:"POST",url:n()+"/SaveModel",data:{name:encodeURIComponent(r),current_ID:i,description:u,image:f},success:function(r){$("#divSaveModelMessage").replaceWith(r);i=$("#LocateModel_ID").val().trim();i!="0"&&(t.hide(),$.ajax({type:"POST",url:n()+"/GetModelsPageNumber",data:{id:i},success:function(n){let t=n;console.log("SetPagination");SetPagination(t,"Models",i)},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}}))},error:function(n,t,i){$("#divSaveModelMessage").html("<b>Произошла ошибка в процесе выполнения!<\/b>");alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})});$("#btnRevisionSave").click(function(){var e=$("#edRevisionName").val().trim(),t,f;if(e==""){alert("Название должно быть задано");return}t=$("#Revision_ID").val().trim();f=u().trim();$.ajax({type:"POST",url:n()+"/SaveRevision",data:{name:encodeURIComponent(e),current_ID:t,model_ID:f},success:function(u){$("#divSaveRevisionMessage").replaceWith(u);t=$("#LocateRevision_ID").val().trim();t!="0"&&(i.hide(),$.ajax({type:"POST",url:n()+"/GetRevisionPageNumber",data:{pModel_ID:f,pRevision_ID:t},success:function(n){let i=n;r(i,t)},error:function(n,t,i){alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}}))},error:function(n,t,i){$("#divSaveRevisionMessage").html("<b>Произошла ошибка в процесе выполнения!<\/b>");alert("Статус: "+t+"; Ошибка: "+i+"; Описание:"+n.responseText)}})});y();$("#btnModelAdd").click(function(){$("#Model_ID").val(0);f()});$("#btnRevisionAdd").click(function(){var n=u();if(n=="0"||n===undefined){alert("Не выбрана текущая модель");return}$("#Revision_ID").val(0);e()});$("#btnModelUpdate").click(function(){var n=u();if(n=="0"||n===undefined){alert("Не выбрана модель для редактирования");return}$("#Model_ID").val(n);f()});$("#btnRevisionUpdate").click(function(){var n=c();if(n=="0"||n===undefined){alert("Не выбрана ревизия для редактирования");return}$("#Revision_ID").val(n);e()});pgrid_function=h;locate_model=p;detail_function=r});